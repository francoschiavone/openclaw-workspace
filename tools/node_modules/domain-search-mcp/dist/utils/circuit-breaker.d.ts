/**
 * Circuit Breaker Pattern Implementation.
 *
 * Prevents cascading failures by temporarily blocking requests to failing services.
 * After a cooldown period, allows a probe request to test if service recovered.
 *
 * States:
 * - CLOSED: Normal operation, requests pass through
 * - OPEN: Service failing, requests blocked immediately
 * - HALF_OPEN: Testing recovery, single request allowed
 */
export interface CircuitBreakerOptions {
    /** Name for logging and metrics */
    name: string;
    /** Number of failures before opening circuit */
    failureThreshold?: number;
    /** Time in ms before attempting recovery (half-open) */
    resetTimeoutMs?: number;
    /** Time window in ms for counting failures */
    failureWindowMs?: number;
    /** Number of successes in half-open needed to close circuit */
    successThreshold?: number;
}
type CircuitState = 'closed' | 'open' | 'half_open';
export declare class CircuitOpenError extends Error {
    readonly circuitName: string;
    readonly openedAt: number;
    readonly resetAt: number;
    constructor(name: string, openedAt: number, resetTimeoutMs: number);
}
export declare class CircuitBreaker {
    private readonly name;
    private readonly failureThreshold;
    private readonly resetTimeoutMs;
    private readonly failureWindowMs;
    private readonly successThreshold;
    private state;
    private failures;
    private lastFailureTime;
    private halfOpenSuccesses;
    private openedAt;
    constructor(options: CircuitBreakerOptions);
    /**
     * Execute a function with circuit breaker protection.
     *
     * @throws CircuitOpenError if circuit is open
     * @throws Original error if function fails and circuit stays closed
     */
    execute<T>(fn: () => Promise<T>): Promise<T>;
    /**
     * Check if circuit should transition from open to half-open.
     */
    private shouldAttemptReset;
    /**
     * Handle successful execution.
     */
    private onSuccess;
    /**
     * Handle failed execution.
     */
    private onFailure;
    /**
     * Transition to a new state.
     */
    private transitionTo;
    /**
     * Remove failures outside the time window.
     */
    private pruneOldFailures;
    /**
     * Get current circuit state (for monitoring).
     */
    getState(): {
        name: string;
        state: CircuitState;
        failures: number;
        lastFailure: number | null;
        openedAt: number | null;
    };
    /**
     * Manually reset the circuit (for testing/admin).
     */
    reset(): void;
    /**
     * Check if circuit is currently allowing requests.
     */
    isAllowingRequests(): boolean;
}
/**
 * Get or create a circuit breaker by name.
 */
export declare function getCircuitBreaker(options: CircuitBreakerOptions): CircuitBreaker;
/**
 * Get all circuit breaker states (for /metrics endpoint).
 */
export declare function getAllCircuitStates(): Array<ReturnType<CircuitBreaker['getState']>>;
/**
 * Reset all circuit breakers (for testing).
 */
export declare function resetAllCircuitBreakers(): void;
export {};
//# sourceMappingURL=circuit-breaker.d.ts.map