"use strict";
/**
 * bulk_search Tool - Search Multiple Domains.
 *
 * Efficiently check availability for many domain names at once.
 * Uses concurrent requests with rate limiting.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.bulkSearchTool = exports.bulkSearchSchema = void 0;
exports.executeBulkSearch = executeBulkSearch;
const zod_1 = require("zod");
const domain_search_js_1 = require("../services/domain-search.js");
const errors_js_1 = require("../utils/errors.js");
/**
 * Input schema for bulk_search.
 */
exports.bulkSearchSchema = zod_1.z.object({
    domains: zod_1.z
        .array(zod_1.z.string())
        .min(1)
        .max(100)
        .describe("List of domain names to check (e.g., ['vibecoding', 'myapp', 'coolstartup']). Max 100 domains."),
    tld: zod_1.z
        .string()
        .optional()
        .default('com')
        .describe("Single TLD to check for all domains (e.g., 'com'). Defaults to 'com'."),
    registrar: zod_1.z
        .string()
        .optional()
        .describe("Optional: specific registrar to use (BYOK only; ignored when Pricing API is configured)."),
});
/**
 * Tool definition for MCP.
 */
exports.bulkSearchTool = {
    name: 'bulk_search',
    description: `Check availability for multiple domain names at once.

Efficiently searches up to 100 domains in parallel with rate limiting.
Use a single TLD for best performance.

Returns:
- Availability status for each domain
- Pricing where available
- Summary statistics

Example:
- bulk_search(["vibecoding", "myapp", "coolstartup"], "io")`,
    inputSchema: {
        type: 'object',
        properties: {
            domains: {
                type: 'array',
                items: { type: 'string' },
                description: "List of domain names to check. Don't include extensions. Max 100.",
            },
            tld: {
                type: 'string',
                description: "TLD to check for all domains (e.g., 'com'). Defaults to 'com'.",
            },
            registrar: {
                type: 'string',
                description: "Optional: specific registrar to use (BYOK only).",
            },
        },
        required: ['domains'],
    },
};
/**
 * Execute the bulk_search tool.
 */
async function executeBulkSearch(input) {
    try {
        const { domains, tld, registrar } = exports.bulkSearchSchema.parse(input);
        const results = await (0, domain_search_js_1.bulkSearchDomains)(domains, tld, registrar);
        const available = results.filter((r) => r.available);
        const taken = results.filter((r) => !r.available);
        const insights = [];
        if (available.length > 0) {
            insights.push(`âœ… ${available.length} of ${domains.length} domains available`);
            const cheapest = available
                .filter((r) => r.price_first_year !== null && r.pricing_status === 'ok')
                .sort((a, b) => a.price_first_year - b.price_first_year)[0];
            if (cheapest) {
                insights.push(`ğŸ’° Best price: ${cheapest.domain} at $${cheapest.price_first_year}/year`);
                if (cheapest.price_check_url) {
                    insights.push(`Verify pricing for ${cheapest.domain}: ${cheapest.price_check_url}`);
                }
            }
        }
        else {
            insights.push(`âŒ All ${domains.length} domains are taken`);
            insights.push('ğŸ’¡ Try different variations or alternative TLDs');
        }
        insights.push('âš ï¸ Prices can change. Verify at registrar checkout links before purchase.');
        return {
            results,
            summary: {
                total: domains.length,
                available: available.length,
                taken: taken.length,
                errors: domains.length - results.length,
            },
            insights,
        };
    }
    catch (error) {
        throw (0, errors_js_1.wrapError)(error);
    }
}
//# sourceMappingURL=bulk_search.js.map