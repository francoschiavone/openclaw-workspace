import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Loader2 } from 'lucide-react';
import { useAuth } from '@/context/AuthContext';

const LoginPage: React.FC = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);
  const { login, token } = useAuth();
  const navigate = useNavigate();

  // Redirect if already logged in
  useEffect(() => {
    if (token) {
      navigate('/dashboard', { replace: true });
    }
  }, [token, navigate]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);
    setLoading(true);

    try {
      await login({ email, password });
      navigate('/dashboard', { replace: true });
    } catch (err: unknown) {
      console.error('Login failed:', err);
      const errorMessage =
        (err as { response?: { data?: { message?: string } } })?.response?.data?.message ||
        'Invalid email or password. Please try again.';
      setError(errorMessage);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div
      className="min-h-screen flex items-center justify-center p-4"
      style={{ backgroundColor: 'var(--page-bg)' }}
    >
      <div className="w-full max-w-md">
        {/* Login Card */}
        <div
          className="rounded-xl shadow-lg p-8"
          style={{ backgroundColor: 'var(--white)' }}
        >
          {/* Logo */}
          <div className="flex items-center justify-center mb-6">
            <svg width="150" height="39" viewBox="0 0 125 32" fill="none">
              <path d="M0.57 12.66C1.47 12.66 2.38 12.66 3.29 12.66C4.07 12.66 4.69 12.66 4.69 12.66C4.61 12.97 4.53 13.24 4.47 13.51C4.12 15.06 4.04 16.63 4.24 18.21C4.38 19.34 4.66 20.43 5.08 21.48C5.57 22.73 6.25 23.87 7.08 24.92C7.54 25.49 8.05 26.03 8.59 26.52C9.25 27.11 9.96 27.63 10.71 28.09C11.62 28.63 12.57 29.06 13.58 29.38C14.41 29.64 15.26 29.84 16.14 29.91C16.49 29.94 16.83 29.95 17.18 29.98C18.53 30.07 19.88 30.01 21.23 30.02C22.82 30.03 24.42 30.02 26.01 30.02L26.29 30.07C26.23 30.12 26.17 30.17 26.10 30.21C25.39 30.55 24.68 30.87 23.90 31.03C23.51 31.12 23.11 31.18 22.72 31.26C22.09 31.39 21.46 31.55 20.85 31.77C20.66 31.85 20.45 31.87 20.24 31.92L19.99 32H19.41L19.14 31.92C18.66 31.88 18.19 31.92 17.71 32H17.28C17.20 31.97 16.45 31.91 15.13 31.78C14.44 31.71 13.76 31.55 13.10 31.35C12.86 31.28 12.63 31.26 12.39 31.34C11.90 31.51 11.44 31.40 11.06 31.06C10.90 30.91 10.76 30.73 10.62 30.55C10.52 30.42 10.40 30.32 10.26 30.24C9.76 29.96 9.27 29.66 8.78 29.37C8.17 28.96 7.86 28.77 7.19 28.40C6.39 27.94 5.65 27.39 4.92 26.83C4.50 26.15 4.28 25.51 4.11 25.07C3.96 24.61 3.68 24.22 3.40 23.82C3.20 23.38 3.04 22.93 2.91 22.36C2.86 22.00 2.69 21.46 2.54 21.06C2.36 20.64 2.10 20.13 1.94 19.98C1.78 19.84 1.64 19.67 1.35 19.29C1.21 18.84 1.15 18.37 1.09 17.85C1.03 17.33 0.96 16.81 0.86 16.15C0.75 15.49 0.64 14.84 0.57 12.66Z" fill="#7AECB4"/>
              <path d="M30.25 20.43C30.31 20.19 30.35 19.98 30.41 19.77C30.65 18.87 30.76 17.96 30.80 17.04C30.85 15.76 30.72 14.51 30.41 13.27C30.17 12.28 29.82 11.33 29.35 10.42C28.87 9.48 28.29 8.60 27.59 7.79C26.71 6.76 25.71 5.88 24.57 5.16C23.47 4.45 22.29 3.92 21.03 3.56C20.21 3.32 19.38 3.17 18.53 3.09C18.10 3.04 17.66 3.02 17.23 3.02C14.53 3.01 11.84 3.01 9.15 3.01H8.82C8.94 2.89 9.08 2.86 9.21 2.83C9.66 2.71 10.11 2.58 10.57 2.48C10.96 2.39 11.30 2.20 11.64 1.98C12.06 1.71 12.50 1.52 13.02 1.58C13.20 1.60 13.36 1.54 13.50 1.39C13.74 1.12 14.05 0.95 14.40 0.84C14.75 0.73 15.11 0.64 15.47 0.54C15.95 0.40 16.43 0.28 16.91 0.14C17.42 0.00 17.93-0.08 18.44 0.11C18.63 0.18 18.82 0.29 19.00 0.39C19.25 0.52 19.51 0.60 19.79 0.59C20.05 0.59 20.31 0.56 20.56 0.56C20.80 0.56 21.03 0.59 21.26 0.62C21.51 0.65 21.76 0.70 22.00 0.72C22.14 0.73 22.28 0.72 22.40 0.68C22.87 0.52 23.29 0.57 23.68 0.88C24.44 1.47 25.19 2.06 25.95 2.65C26.08 2.75 26.21 2.84 26.38 2.86C26.79 2.91 27.11 3.12 27.39 3.43C27.95 4.04 28.51 4.63 29.06 5.24C29.39 5.61 29.65 6.02 29.71 6.52C29.74 6.73 29.84 6.90 29.98 7.05C30.25 7.34 30.51 7.64 30.80 7.91C31.06 8.16 31.27 8.43 31.42 8.76C31.72 9.40 32.02 10.04 32.31 10.69C32.55 11.22 32.61 11.78 32.60 12.35C32.59 12.71 32.70 13.05 32.77 13.39C32.86 13.54 32.97 13.86 33.09 13.93C33.28 14.32 33.37 14.81 33.37 15.68C33.38 16.11 33.39 16.54 33.40 16.97C33.41 17.45 33.32 17.91 33.05 18.33C32.95 18.59 32.95 18.85 33.09 18.94C33.32 19.10 33.44 19.33 33.43 19.61C33.43 19.83 33.40 20.05 33.37 20.28C33.35 20.42 33.31 20.45 33.13 20.45C32.62 20.45 32.11 20.45 31.60 20.45C31.23 20.45 30.87 20.45 30.50 20.45C30.43 20.43 30.35 20.43 30.25 20.43Z" fill="#7AECB4"/>
              <path d="M3.38 6.79C3.50 6.70 3.63 6.60 3.75 6.50C4.02 6.27 4.29 6.03 4.56 5.81C4.91 5.51 5.31 5.35 5.79 5.41C6.14 5.46 6.45 5.33 6.70 5.10C6.82 4.98 6.96 4.96 7.11 4.96C10.54 4.97 13.96 4.98 17.38 4.96C19.21 4.95 20.92 5.38 22.55 6.18C23.39 6.60 24.16 7.14 24.87 7.75C26.15 8.84 27.13 10.15 27.84 11.66C28.27 12.59 28.58 13.57 28.74 14.59C29.04 16.44 28.92 18.26 28.35 20.05C28.31 20.17 28.26 20.29 28.22 20.42C27.53 20.42 26.85 20.42 26.15 20.42C26.22 20.22 26.28 20.04 26.35 19.86C26.67 19.04 26.86 18.18 26.93 17.30C27.01 16.04 26.90 14.81 26.50 13.60C26.20 12.68 25.79 11.82 25.23 11.03C24.60 10.13 23.84 9.36 22.95 8.71C21.86 7.91 20.64 7.40 19.33 7.10C18.75 6.96 18.15 6.89 17.55 6.89C16.24 6.88 14.93 6.86 13.62 6.86C10.31 6.86 6.99 6.86 3.69 6.86C3.59 6.86 3.50 6.86 3.40 6.86C3.39 6.84 3.39 6.81 3.38 6.79Z" fill="#7AECB4"/>
              <path d="M8.44 12.66C8.41 12.76 8.41 12.82 8.38 12.88C8.17 13.38 8.00 13.91 7.88 14.44C7.69 15.33 7.62 16.23 7.68 17.14C7.77 18.59 8.18 19.95 8.89 21.21C9.43 22.17 10.11 23.03 10.96 23.75C11.52 24.23 12.11 24.66 12.76 25.00C13.54 25.42 14.35 25.71 15.20 25.91C15.90 26.07 16.61 26.14 17.32 26.14C20.56 26.14 23.79 26.16 27.03 26.16C28.11 26.17 29.20 26.16 30.28 26.16C30.36 26.16 30.44 26.16 30.57 26.16C30.52 26.26 30.51 26.32 30.47 26.35C30.03 26.77 29.58 27.18 29.13 27.58C28.99 27.71 28.84 27.84 28.69 27.96C28.62 28.01 28.52 28.03 28.42 28.05C28.35 28.07 28.28 28.05 28.21 28.05C24.77 28.05 21.34 28.05 17.91 28.05C17.41 28.05 16.91 28.07 16.41 28.05C15.62 28.01 14.86 27.85 14.10 27.64C12.70 27.23 11.42 26.59 10.27 25.71C9.04 24.77 8.03 23.63 7.26 22.30C6.44 20.87 5.94 19.34 5.77 17.70C5.60 16.08 5.78 14.49 6.28 12.94C6.29 12.89 6.31 12.85 6.32 12.80C6.35 12.71 6.40 12.66 6.51 12.66C7.14 12.66 7.78 12.66 8.44 12.66Z" fill="#7AECB4"/>
              <path d="M21.59 20.42C21.74 20.21 21.87 20.04 22.00 19.86C22.48 19.24 22.77 18.54 22.94 17.79C23.31 16.14 23.01 14.60 22.05 13.22C21.23 12.02 20.08 11.26 18.67 10.90C18.08 10.75 17.47 10.70 16.87 10.70C11.79 10.70 6.72 10.70 1.64 10.70C1.54 10.70 1.44 10.70 1.33 10.70C1.33 10.39 1.33 10.11 1.34 9.83C1.35 9.44 1.55 9.14 1.81 8.88C1.84 8.85 1.89 8.84 1.94 8.83C1.99 8.82 2.06 8.83 2.13 8.83C7.05 8.83 11.97 8.83 16.89 8.83C17.28 8.83 17.66 8.75 18.05 8.83C18.51 8.91 18.98 8.96 19.43 9.09C20.47 9.38 21.41 9.87 22.24 10.57C23.12 11.31 23.83 12.20 24.32 13.25C24.64 13.95 24.86 14.68 24.96 15.45C25.08 16.32 25.06 17.18 24.88 18.05C24.72 18.81 24.45 19.54 24.09 20.22C24.01 20.37 23.92 20.44 23.75 20.43C23.10 20.42 22.45 20.43 21.81 20.43C21.75 20.43 21.68 20.42 21.59 20.42Z" fill="#7AECB4"/>
              <path d="M12.96 12.68C12.84 12.85 12.74 12.99 12.64 13.12C12.02 13.95 11.66 14.87 11.56 15.89C11.42 17.31 11.73 18.63 12.56 19.81C13.53 21.18 14.86 21.97 16.51 22.24C16.85 22.29 17.20 22.31 17.55 22.31C22.61 22.32 27.66 22.31 32.72 22.31H33.07C33.03 22.49 33.00 22.64 32.96 22.79C32.82 23.25 32.62 23.67 32.36 24.06C32.08 24.20 31.88 24.20 17.80 24.20C17.44 24.20 17.08 24.23 16.71 24.21C16.04 24.16 15.39 24.02 14.75 23.79C13.48 23.35 12.41 22.62 11.52 21.62C10.69 20.69 10.13 19.63 9.83 18.44C9.46 17.03 9.50 15.63 9.92 14.24C10.07 13.74 10.27 13.27 10.53 12.81C10.77 12.66 11.46 12.66 12.84 12.66H12.96Z" fill="#7AECB4"/>
              <path d="M21.17 16.52C21.18 18.70 19.37 20.39 17.29 20.38C15.19 20.37 13.44 18.68 13.44 16.52C13.43 14.37 15.23 12.55 17.50 12.66C19.44 12.75 21.18 14.36 21.17 16.52ZM19.22 16.52C19.24 15.39 18.26 14.57 17.28 14.59C16.25 14.61 15.40 15.47 15.38 16.50C15.37 17.57 16.29 18.43 17.29 18.44C18.24 18.44 19.24 17.66 19.22 16.52Z" fill="#7AECB4"/>
              <path fillRule="evenodd" clipRule="evenodd" d="M43 22.796V9H45.232V20.63H52.391V22.796H43ZM65.993 9V16.844C65.993 18.813 65.439 20.363 64.418 21.423C63.398 22.482 61.96 23 60.289 23C58.636 23 57.204 22.482 56.185 21.439C55.165 20.395 54.604 18.873 54.604 16.955V9H56.835V16.863C56.835 18.195 57.181 19.179 57.762 19.827C58.339 20.471 59.195 20.834 60.326 20.834C61.417 20.834 62.26 20.499 62.832 19.882C63.408 19.263 63.761 18.304 63.761 16.955V9H65.993ZM69.499 22.796V9H71.564L75.984 15.76L80.405 9H82.469V22.796H80.238V13.193L76.213 19.235H75.719L71.694 13.209V22.796H69.499ZM86.182 22.796V9H91.995C93.52 9 94.776 9.448 95.598 10.265C96.203 10.904 96.536 11.691 96.536 12.634V12.671C96.536 14.114 95.865 15.031 95.067 15.601C95.54 15.819 95.975 16.099 96.331 16.462C96.899 17.042 97.244 17.813 97.244 18.810V18.847C97.244 20.088 96.726 21.096 95.818 21.780C94.923 22.454 93.677 22.796 92.231 22.796H86.182ZM100.203 22.796V9H110.194V11.148H102.435V14.769H109.376V16.916H102.435V20.648H110.285V22.796H100.203ZM113.284 22.796V9H119.152C120.79 9 122.156 9.506 123.049 10.417C123.748 11.131 124.147 12.146 124.147 13.264V13.301C124.147 14.478 123.746 15.436 123.055 16.147C122.506 16.711 121.789 17.105 120.982 17.339L125 22.796H122.241L118.552 17.751H115.516V22.796H113.284ZM88.396 11.129V14.787H91.759C92.569 14.787 93.207 14.599 93.632 14.278C94.042 13.968 94.286 13.512 94.286 12.875V12.838C94.286 12.318 94.089 11.912 93.717 11.624C93.331 11.326 92.723 11.129 91.868 11.129H88.396ZM88.396 16.898V20.667H92.268C93.178 20.667 93.868 20.460 94.319 20.127C94.756 19.805 94.995 19.348 94.995 18.754V18.717C94.995 18.146 94.769 17.719 94.316 17.415C93.840 17.096 93.084 16.898 92.013 16.898H88.396ZM115.516 11.166V15.622H119.025C119.915 15.622 120.639 15.388 121.131 14.998C121.613 14.616 121.897 14.066 121.897 13.357V13.320C121.897 12.637 121.646 12.120 121.195 11.763C120.731 11.395 120.014 11.166 119.043 11.166H115.516Z" fill="#1e2d3b"/>
            </svg>
          </div>

          {/* Subtitle */}
          <p className="text-center text-[#6b7280] mb-8">Sign in to your account</p>

          {/* Error Message */}
          {error && (
            <div className="mb-6 p-4 rounded-lg bg-red-50 border border-red-200">
              <p className="text-sm text-red-600">{error}</p>
            </div>
          )}

          {/* Login Form */}
          <form onSubmit={handleSubmit} className="space-y-5">
            {/* Email Field */}
            <div>
              <label
                htmlFor="email"
                className="block text-sm font-medium text-[#374151] mb-2"
              >
                Email address
              </label>
              <input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                disabled={loading}
                className="w-full px-4 py-3 rounded-lg border border-[#d0d5dd] text-[#111827] placeholder-[#9ca3af] focus:outline-none focus:ring-2 focus:ring-[#7aecb4] focus:border-transparent transition-all disabled:bg-gray-50 disabled:cursor-not-allowed"
                placeholder="you@example.com"
              />
            </div>

            {/* Password Field */}
            <div>
              <label
                htmlFor="password"
                className="block text-sm font-medium text-[#374151] mb-2"
              >
                Password
              </label>
              <input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                disabled={loading}
                className="w-full px-4 py-3 rounded-lg border border-[#d0d5dd] text-[#111827] placeholder-[#9ca3af] focus:outline-none focus:ring-2 focus:ring-[#7aecb4] focus:border-transparent transition-all disabled:bg-gray-50 disabled:cursor-not-allowed"
                placeholder="Enter your password"
              />
            </div>

            {/* Submit Button */}
            <button
              type="submit"
              disabled={loading || !email || !password}
              className="w-full py-3 px-4 rounded-lg font-semibold text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed"
              style={{
                backgroundColor: loading ? '#9ca3af' : '#7aecb4',
              }}
            >
              {loading ? (
                <span className="flex items-center justify-center gap-2">
                  <Loader2 className="w-5 h-5 animate-spin" />
                  Signing in...
                </span>
              ) : (
                'Sign In'
              )}
            </button>
          </form>

          {/* Footer */}
          <div className="mt-6 text-center">
            <p className="text-sm text-[#6b7280]">
              Having trouble?{' '}
              <a
                href="mailto:support@lumberfi.com"
                className="text-[#2563eb] hover:underline font-medium"
              >
                Contact support
              </a>
            </p>
          </div>
        </div>

        {/* Brand Footer */}
        <p className="text-center text-xs text-[#9ca3af] mt-6">
          Â© {new Date().getFullYear()} Lumber. All rights reserved.
        </p>
      </div>
    </div>
  );
};

export default LoginPage;
